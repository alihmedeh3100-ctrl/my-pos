<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Cairo', sans-serif; background-color: #fff5f5; }</style>
</head>
<body class="p-4">

    <div class="max-w-5xl mx-auto">
        <div class="flex justify-between items-center mb-8 bg-white p-6 rounded-2xl shadow-sm border-r-8 border-red-600">
            <h1 class="text-2xl font-black text-red-700 flex items-center gap-2">ğŸ”„ Ù‚Ø³Ù… Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª</h1>
            <a href="pos.html" class="bg-gray-800 text-white px-6 py-2 rounded-xl">Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¨ÙŠØ¹</a>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="bg-white p-8 rounded-3xl shadow-lg">
                <h2 class="text-lg font-bold mb-6 text-gray-700">ØªØ³Ø¬ÙŠÙ„ Ù‚Ø·Ø¹Ø© Ù…Ø±ØªØ¬Ø¹Ø©</h2>
                <div class="space-y-4">
                    <div>
                        <label class="text-sm text-gray-500">Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø·Ø¹Ø©</label>
                        <input id="ret-barcode" type="text" class="w-full p-3 border-2 border-red-50 rounded-xl outline-none focus:border-red-500 font-mono" placeholder="Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯...">
                    </div>
                    <div>
                        <label class="text-sm text-gray-500">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ø±Ø¬Ø§Ø¹Ù‡ Ù„Ù„Ø²Ø¨ÙˆÙ† ($)</label>
                        <input id="ret-amount" type="number" class="w-full p-3 border-2 border-red-50 rounded-xl outline-none focus:border-red-500 font-bold text-red-600" placeholder="0.00">
                    </div>
                    <div>
                        <label class="text-sm text-gray-500">Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹</label>
                        <select id="ret-reason" class="w-full p-3 border-2 border-red-50 rounded-xl outline-none focus:border-red-500">
                            <option value="damage">Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø© (Ø¹Ø·Ù„/ÙƒØ³Ø±)</option>
                            <option value="change">ØªØ¨Ø¯ÙŠÙ„ Ø±Ø£ÙŠ Ø§Ù„Ø²Ø¨ÙˆÙ†</option>
                            <option value="other">Ø³Ø¨Ø¨ Ø¢Ø®Ø±</option>
                        </select>
                    </div>
                    <div id="other-reason-box" class="hidden">
                        <input id="ret-note" type="text" class="w-full p-3 border-2 border-red-50 rounded-xl outline-none" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¨Ø¨ Ù‡Ù†Ø§...">
                    </div>
                    <button onclick="processReturn()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 rounded-2xl shadow-lg transition mt-4">
                        ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ ÙˆØ®ØµÙ… Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù† Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
                    </button>
                </div>
            </div>

            <div class="bg-white p-8 rounded-3xl shadow-lg border border-red-50 overflow-hidden">
                <h2 class="text-lg font-bold mb-4">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h2>
                <div class="overflow-y-auto max-h-[400px]">
                    <table class="w-full text-right text-sm">
                        <thead class="bg-red-50">
                            <tr>
                                <th class="p-2">Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</th>
                                <th class="p-2">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th class="p-2">Ø§Ù„Ø³Ø¨Ø¨</th>
                            </tr>
                        </thead>
                        <tbody id="returns-log" class="divide-y">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script>
        checkAuth();

        // Ø±Ø¨Ø· Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
        document.getElementById('ret-reason').addEventListener('change', function() {
            document.getElementById('other-reason-box').classList.toggle('hidden', this.value !== 'other');
        });
      function processReturn() {
            const barcode = document.getElementById('ret-barcode').value;
            const amount = parseFloat(document.getElementById('ret-amount').value) || 0;
            const reason = document.getElementById('ret-reason').value;
            const note = document.getElementById('ret-note').value;

            if (!barcode || amount <= 0) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙˆØ§Ù„Ù…Ø¨Ù„Øº!");

            // 1. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²Ù† (Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙƒÙ…ÙŠØ©)
            let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
            let productIndex = inventory.findIndex(p => p.barcode === barcode);
            if (productIndex !== -1) {
                inventory[productIndex].qty += 1;
                localStorage.setItem('inventory', JSON.stringify(inventory));
            }

            // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ (Ø®ØµÙ… Ù…Ù† Ø§Ù„ÙƒØ§Ø´)
            let funds = JSON.parse(localStorage.getItem('funds')) || { cash: 0, wish: 0, plus: 0, mobi: 0 };
            if (funds.cash < amount) {
                if (!confirm("Ø±ØµÙŠØ¯ Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ù…Ø¨Ù„ØºØŒ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø®ØµÙ… Ø§Ù„Ù…Ø¨Ù„Øº Ù„ÙŠ
