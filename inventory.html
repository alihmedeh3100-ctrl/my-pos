<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ุงููุฎุฒู - ุฅุถุงูุฉ ุงูุจุถุงุนุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; }</style>
</head>
<body class="p-6">
    <div class="max-w-6xl mx-auto">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-slate-800">๐ฆ ุฅุฏุงุฑุฉ ุงููุฎุฒู</h1>
            <a href="pos.html" class="bg-blue-600 text-white px-6 py-2 rounded-xl font-bold shadow-md hover:bg-blue-700">ุงูุนูุฏุฉ ููุจูุน ๐</a>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-sm mb-8 border border-slate-200">
            <h2 class="text-lg font-bold mb-4 text-slate-600 border-b pb-2">ุฅุถุงูุฉ ูุทุนุฉ ุฌุฏูุฏุฉ</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <input id="inv-barcode" type="text" placeholder="ุงูุจุงุฑููุฏ (Scan)" class="p-3 border rounded-xl outline-none focus:border-blue-500 font-mono">
                <input id="inv-name" type="text" placeholder="ุงุณู ุงููุทุนุฉ" class="p-3 border rounded-xl outline-none focus:border-blue-500">
                <input id="inv-vendor" type="text" placeholder="ุงุณู ุงูููุฑุฏ" class="p-3 border rounded-xl outline-none focus:border-blue-500">
                <input id="inv-qty" type="number" placeholder="ุงููููุฉ" class="p-3 border rounded-xl outline-none focus:border-blue-500">
                <input id="inv-cost" type="number" step="0.01" placeholder="ุณุนุฑ ุงูุดุฑุงุก ($)" class="p-3 border rounded-xl outline-none focus:border-blue-500">
                <input id="inv-retail" type="number" step="0.01" placeholder="ุณุนุฑ ููุฑู ($)" class="p-3 border rounded-xl outline-none focus:border-blue-500 text-green-700 font-bold">
                <input id="inv-wholesale" type="number" step="0.01" placeholder="ุณุนุฑ ุฌููุฉ ($)" class="p-3 border rounded-xl outline-none focus:border-blue-500 text-blue-700 font-bold">
                <button id="save-btn" onclick="saveToInventory()" class="bg-green-600 text-white font-bold rounded-xl py-3 shadow-lg hover:bg-green-700 transition transform active:scale-95">ุญูุธ ูู ุงููุฎุฒู โ</button>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-sm overflow-hidden border border-slate-200">
            <table class="w-full text-right">
                <thead class="bg-slate-50 border-b">
                    <tr>
                        <th class="p-4 text-slate-600">ุงูุจุงุฑููุฏ</th>
                        <th class="p-4 text-slate-600">ุงุณู ุงููุทุนุฉ</th>
                        <th class="p-4 text-slate-600 text-center">ุงููููุฉ</th>
                        <th class="p-4 text-slate-600">ุณุนุฑ ุงูููุฑู</th>
                        <th class="p-4 text-slate-600 text-center">ุฎูุงุฑุงุช</th>
                    </tr>
                </thead>
                <tbody id="inventory-list" class="divide-y">
                    </tbody>
            </table>
        </div>
    </div>

    <script src="auth.js"></script>
    <script>
        // ุงูุชุญูู ูู ุงูุตูุงุญูุงุช (Admin ููุท)
        checkAuth();

        // 1. ุฌูุจ ุงูุจูุงูุงุช ูู ุงูุฐุงูุฑุฉ ุนูุฏ ุงูุชุญููู
        let inventory = JSON.parse(localStorage.getItem('inventory')) || [];

        // 2. ูุธููุฉ ุงูุญูุธ
        function saveToInventory() {
            // ุฌูุจ ุงูุนูุงุตุฑ
            const barcode = document.getElementById('inv-barcode').value.trim();
            const name = document.getElementById('inv-name').value.trim();
            const vendor = document.getElementById('inv-vendor').value.trim();
            const qty = parseInt(document.getElementById('inv-qty').value) || 0;
            const cost = parseFloat(document.getElementById('inv-cost').value) || 0;
            const retail = parseFloat(document.getElementById('inv-retail').value) || 0;
            const wholesale = parseFloat(document.getElementById('inv-wholesale').value) || 0;
            // ุงูุชุญูู ูู ุงููุฏุฎูุงุช ุงูุฃุณุงุณูุฉ
            if (!barcode || !name) {
                alert("ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงูุจุงุฑููุฏ ูุงุณู ุงููุทุนุฉ ุนูู ุงูุฃูู!");
                return;
            }

            // ุงูุชุฃูุฏ ุฅุฐุง ูุงู ุงูุจุงุฑููุฏ ููุฌูุฏ ูุณุจูุงู (ูุชุญุฏูุซ ุงููููุฉ ููุท ุจุฏูุงู ูู ุฅุถุงูุฉ ุตู ุฌุฏูุฏ)
            let existingProductIndex = inventory.findIndex(p => p.barcode === barcode);

            if (existingProductIndex !== -1) {
                // ุชุญุฏูุซ ุงููุทุนุฉ ุงูููุฌูุฏุฉ
                inventory[existingProductIndex].qty += qty;
                inventory[existingProductIndex].retail = retail; // ุชุญุฏูุซ ุงูุณุนุฑ ุฃูุถุงู
                alert("ุชู ุชุญุฏูุซ ูููุฉ ุงููุทุนุฉ ุงูููุฌูุฏุฉ ูุณุจูุงู.");
            } else {
                // ุฅุถุงูุฉ ูุทุนุฉ ุฌุฏูุฏุฉ ุจุงููุงูู
                const newProduct = {
                    barcode: barcode,
                    name: name,
                    vendor: vendor,
                    qty: qty,
                    cost: cost,
                    retail: retail,
                    wholesale: wholesale
                };
                inventory.push(newProduct);
                alert("ุชูุช ุฅุถุงูุฉ ุงููุทุนุฉ ุงูุฌุฏูุฏุฉ ุจูุฌุงุญ โ");
            }

            // 3. ุญูุธ ุงููุตูููุฉ ูู localStorage
            localStorage.setItem('inventory', JSON.stringify(inventory));

            // 4. ุชุญุฏูุซ ุงูุฌุฏูู ููุณุญ ุงูุฎุงูุงุช
            renderInventory();
            clearInputs();
        }

        // ูุธููุฉ ุนุฑุถ ุงูุฌุฏูู
        function renderInventory() {
            const listBody = document.getElementById('inventory-list');
            listBody.innerHTML = inventory.map((item, index) => 
                <tr class="hover:bg-slate-50 transition">
                    <td class="p-4 font-mono text-sm">${item.barcode}</td>
                    <td class="p-4 font-bold text-slate-800">${item.name}</td>
                    <td class="p-4 text-center">
                        <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full font-bold text-xs">${item.qty}</span>
                    </td>
                    <td class="p-4 text-green-700 font-black">${item.retail.toFixed(2)} $</td>
                    <td class="p-4 text-center">
                        <button onclick="deleteProduct(${index})" class="text-red-500 hover:text-red-700 font-bold text-sm">ุญุฐู</button>
                    </td>
                </tr>
            ).join('');
            
            if (inventory.length === 0) {
                listBody.innerHTML = <tr><td colspan="5" class="p-8 text-center text-gray-400">ูุง ุชูุฌุฏ ุจุถุงุนุฉ ูู ุงููุฎุฒู ุญุงููุงู</td></tr>;
            }
        }

        // ูุธููุฉ ุงูุญุฐู
        function deleteProduct(index) {
            if (confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงููุทุนุฉ ููุงุฆูุงูุ")) {
                inventory.splice(index, 1);
                localStorage.setItem('inventory', JSON.stringify(inventory));
                renderInventory();
            }
        }

        // ูุธููุฉ ูุณุญ ุงูุฎุงูุงุช
        function clearInputs() {
            document.querySelectorAll('input').forEach(input => input.value = "");
            document.getElementById('inv-barcode').focus();
        }

        // ุชุดุบูู ุงูุนุฑุถ ุนูุฏ ูุชุญ ุงูุตูุญุฉ
        renderInventory();
    </script>
</body>
</html>
