<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Cairo', sans-serif; background-color: #f0f2f5; }</style>
</head>
<body class="p-4">

    <div class="max-w-6xl mx-auto">
        <div class="flex justify-between items-center mb-8 bg-white p-6 rounded-2xl shadow-sm">
            <h1 class="text-2xl font-black text-green-700 flex items-center gap-2">ğŸ’° Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ ÙˆØ§Ù„Ù…Ø§Ù„</h1>
            <a href="pos.html" class="bg-gray-800 text-white px-6 py-2 rounded-xl">Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¨ÙŠØ¹</a>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-white p-6 rounded-2xl shadow-sm border-r-8 border-green-500">
                <p class="text-gray-500 text-sm">Ù†Ù‚Ø¯ÙŠ (Cash)</p>
                <p id="bal-cash" class="text-3xl font-black text-green-600">0.00</p>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border-r-8 border-orange-500">
                <p class="text-gray-500 text-sm">Wish Money</p>
                <p id="bal-wish" class="text-3xl font-black text-orange-600">0.00</p>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border-r-8 border-blue-500">
                <p class="text-gray-500 text-sm">Cash Plus</p>
                <p id="bal-plus" class="text-3xl font-black text-blue-600">0.00</p>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border-r-8 border-red-500">
                <p class="text-gray-500 text-sm">Mobitek</p>
                <p id="bal-mobi" class="text-3xl font-black text-red-600">0.00</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="bg-white p-8 rounded-3xl shadow-lg border border-gray-100">
                <h2 class="text-lg font-bold mb-6">Ø¥Ø¬Ø±Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ù…Ø§Ù„ÙŠØ©</h2>
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <label class="block">Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:</label>
                        <select id="fund-type" class="w-full p-2 border rounded-lg" onchange="toggleTransferField()">
                            <option value="deposit">Ø¥ÙŠØ¯Ø§Ø¹ (Ø²ÙŠØ§Ø¯Ø©)</option>
                            <option value="withdraw">Ø³Ø­Ø¨ (Ø¥Ù†Ù‚Ø§Øµ)</option>
                            <option value="transfer">ØªØ­ÙˆÙŠÙ„ Ù…Ø¨Ù„Øº</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <label id="source-label">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚:</label>
                        <select id="fund-source" class="w-full p-2 border rounded-lg font-bold">
                            <option value="cash">Cash</option>
                            <option value="wish">Wish Money</option>
                            <option value="plus">Cash Plus</option>
                            <option value="mobi">Mobitek</option>
                        </select>
                    </div>
                    <div id="transfer-box" class="grid grid-cols-2 gap-4 hidden">
                        <label class="text-blue-600 font-bold">Ø¥Ù„Ù‰ ØµÙ†Ø¯ÙˆÙ‚:</label>
                        <select id="fund-dest" class="w-full p-2 border border-blue-200 rounded-lg font-bold bg-blue-50">
                            <option value="cash">Cash</option>
                            <option value="wish">Wish Money</option>
                            <option value="plus">Cash Plus</option>
                            <option value="mobi">Mobitek</option>
                        </select>
                    </div>
                    <div>
                        <label class="block">Ø§Ù„Ù…Ø¨Ù„Øº:</label>
                        <input id="fund-amount" type="number" class="w-full p-3 border rounded-xl text-center text-2xl font-bold focus:border-green-500 outline-none" placeholder="0.00">
                    </div>
                    <button onclick="executeTransaction()" class="w-full bg-green-600 text-white py-4 rounded-2xl font-bold shadow-lg hover:bg-green-700 transition mt-4">ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ© âœ…</button>
                </div>
            </div>

            <div class="bg-white p-8 rounded-3xl shadow-lg overflow-hidden">
                <h2 class="text-lg font-bold mb-4 italic">Ø¢Ø®Ø± Ø§Ù„ØªØ­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h2>
                <div class="overflow-y-auto max-h-[400px]">
                    <table class="w-full text-right text-sm">
                        <tbody id="fund-log" class="divide-y">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script>
        checkAuth(); // Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©

        let funds = JSON.parse(localStorage.getItem('funds')) || { cash: 0, wish: 0, plus: 0, mobi: 0 };
        let fundHistory = JSON.parse(localStorage.getItem('fundHistory')) || [];

        function toggleTransferField() {
            const type = document.getElementById('fund-type').value;
            document.getElementById('transfer-box').classList.toggle('hidden', type !== 'transfer');
            document.getElementById('source-label').innerText = (type === 'transfer') ? "Ù…Ù† ØµÙ†Ø¯ÙˆÙ‚:" : "Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚:";
        }

        function executeTransaction() {
            const type = document.getElementById('fund-type').value;
            const source = document.getElementById('fund-source').value;
            const amount = parseFloat(document.getElementById('fund-amount').value) || 0;
            const dest = document.getElementById('fund-dest').value;

            if (amount <= 0) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­");

            if (type === 'deposit') {
                funds[source] += amount;
                logAction(Ø¥ÙŠØ¯Ø§Ø¹ ÙÙŠ ${source}, amount);
            } else if (type === 'withdraw') {
                if (funds[source] < amount) return alert("Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ!");
                funds[source] -= amount;
                logAction(Ø³Ø­Ø¨ Ù…Ù† ${source}, -amount);
            } else if (type === 'transfer') {
                if (source === dest) return alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù†ÙØ³ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚!");
                if (funds[source] < amount) return alert("Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ Ù„Ù„ØªØ­ÙˆÙŠÙ„!");
                funds[source] -= amount;
                funds[dest] += amount;
                logAction(ØªØ­ÙˆÙŠÙ„ Ù…Ù† ${source} Ø¥Ù„Ù‰ ${dest}, amount);
            }

            saveAndUpdateUI();
        }

        function logAction(msg, amt) {
            fundHistory.unshift({
                desc: msg,
                amount: amt,
                date: new Date().toLocaleTimeString('ar-EG')
            });
            if (fundHistory.length > 50) fundHistory.pop();
        }

        function saveAndUpdateUI() {
            localStorage.setItem('funds', JSON.stringify(funds));
            localStorage.setItem('fundHistory', JSON.stringify(fundHistory));
            
            document.getElementById('bal-cash').innerText = funds.cash.toFixed(2);
            document.getElementById('bal-wish').innerText = funds.wish.toFixed(2);
            document.getElementById('bal-plus').innerText = funds.plus.toFixed(2);
            document.getElementById('bal-mobi').innerText = funds.mobi.toFixed(2);

            document.getElementById('fund-log').innerHTML = fundHistory.map(h => `
                <tr class="py-2">
                    <td class="py-3 text-gray-700">${h.desc}</td>
                    <td class="py-3 font-bold ${h.amount >= 0 ? 'text-green-600' : 'text-red-600'}">${h.amount.toFixed(2)}</td>
                    <td class="py-3 text-xs text-gray-400">${h.date}</td>
                </tr>
            `).join('');
            
            document.getElementById('fund-amount').value = '';
        }

        saveAndUpdateUI(); // Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    </script>
</body>
</html>
