<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ - POS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; }</style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-blue-700 text-white p-4 shadow-lg flex justify-between items-center">
        <h1 class="text-xl font-bold">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø³Ø±ÙŠØ¹</h1>
        <div class="flex gap-4">
            <span id="user-display" class="bg-blue-800 px-3 py-1 rounded text-sm"></span>
            <button onclick="logout()" class="bg-red-500 px-3 py-1 rounded text-sm hover:bg-red-600">Ø®Ø±ÙˆØ¬</button>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <aside class="w-48 bg-gray-800 text-white p-4 hidden md:block">
            <nav class="space-y-4">
                <a href="pos.html" class="block bg-blue-600 p-2 rounded text-center">ğŸ›’ Ø§Ù„Ø¨ÙŠØ¹</a>
                <a href="inventory.html" id="link-inventory" class="block hover:bg-gray-700 p-2 rounded text-center">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²Ù†</a>
                <a href="funds.html" id="link-funds" class="block hover:bg-gray-700 p-2 rounded text-center">ğŸ’° Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</a>
                <a href="reports.html" id="link-reports" class="block hover:bg-gray-700 p-2 rounded text-center">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a>
            </nav>
        </aside>

        <main class="flex-1 p-4 grid grid-cols-1 lg:grid-cols-3 gap-4">
            
            <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border p-4 flex flex-col">
                <div class="flex flex-wrap gap-4 mb-4">
                    <div class="flex-1">
                        <label class="block text-xs text-gray-500 mb-1">Ù†ÙˆØ¹ Ø§Ù„Ø²Ø¨ÙˆÙ†</label>
                        <select id="cust-type" class="w-full border p-2 rounded bg-gray-50 outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="retail">Ø²Ø¨ÙˆÙ† ÙÙˆØ±ÙŠ (Ù…ÙØ±Ù‚)</option>
                            <option value="wholesale">Ø²Ø¨ÙˆÙ† Ø¬Ù…Ù„Ø©</option>
                        </select>
                    </div>
                    <div class="flex-[2]">
                        <label class="block text-xs text-gray-500 mb-1">Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ (Ø§Ø¶ØºØ· Enter Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø³Ø­)</label>
                        <input id="barcode-scan" type="text" placeholder="Ø³ÙƒØ§Ù†Ø±..." class="w-full border-2 border-blue-400 p-2 rounded outline-none focus:border-blue-600 font-mono">
                    </div>
                </div>

                <div class="flex-1 overflow-y-auto">
                    <table class="w-full text-right border-collapse">
                        <thead>
                            <tr class="bg-gray-100 border-b">
                                <th class="p-2 text-sm text-gray-600">Ø§Ù„Ù‚Ø·Ø¹Ø©</th>
                                <th class="p-2 text-sm text-gray-600">Ø§Ù„Ø³Ø¹Ø±</th>
                                <th class="p-2 text-sm text-gray-600">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th class="p-2 text-sm text-gray-600">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                <th class="p-2 text-sm text-gray-600">Ø­Ø°Ù</th>
                            </tr>
                        </thead>
                        <tbody id="cart-table">
                            </tbody>
                    </table>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border p-6 flex flex-col justify-between">
                <div>
                    <h2 class="text-xl font-bold mb-6 border-b pb-2">Ù…Ù„Ø®Øµ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h2>
                    <div class="flex justify-between mb-4">
                        <span class="text-gray-600">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
                        <span id="sub-total" class="font-bold text-lg">0.00</span>
                    </div>
                    <div class="flex justify-between mb-4 items-center">
                        <span class="text-gray-600">Ø§Ù„Ø®ØµÙ… ($):</span>
                        <input id="discount" type="number" value="0" oninput="updateTotals()" class="w-24 border p-1 rounded text-center text-red-600 font-bold">
                    </div>
                    <hr class="my-4">
                    <div class="flex justify-between items-center text-blue-700">
                        <span class="text-xl font-bold">Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¯ÙØ¹ÙÙ‡:</span>
                        <span id="final-total" class="text-4xl font-black">0.00</span>
                    </div>
                </div>

                <button onclick="confirmSale()" class="w-full bg-green-600 text-white py-6 rounded-2xl font-bold text-2xl shadow-lg hover:bg-green-700 transition transform active:scale-95 mt-6">
                    Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (ØªÙ…) âœ…
                </button>
            </div>
        </main>
    </div>

    <script src="auth.js"></script>
    <script>
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙˆØ± ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        checkAuth();
        document.getElementById('user-display').innerText = "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: " + sessionStorage.getItem("userRole");

        // Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© Ù…Ø¤Ù‚ØªØ© Ù„Ù„Ù…Ø®Ø²Ù† Ù„ÙƒÙŠ ØªØ¬Ø±Ø¨ Ø§Ù„ØµÙØ­Ø©
        let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
        let cart = [];

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
        const scanInput = document.getElementById('barcode-scan');
        scanInput.focus(); // Ø¬Ø¹Ù„ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯

        scanInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const code = scanInput.value.trim();
                const product = inventory.find(p => p.barcode === code);
                
                if (product) {
                    const price = document.getElementById('cust-type').value === 'wholesale' ? product.wholesale : product.retail;
                    addToCart(product, price);
                } else {
                    alert("Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø·Ø¹Ø© ØºÙŠØ± Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†!");
                }
                scanInput.value = '';
            }
        });

        function addToCart(product, price) {
            cart.push({ ...product, salePrice: price });
            renderCart();
        }

        function renderCart() {
            const tbody = document.getElementById('cart-table');
            tbody.innerHTML = cart.map((item, index) => 
                <tr class="border-b text-sm">
                    <td class="p-3">${item.name}</td>
                    <td class="p-3">${item.salePrice}</td>
                    <td class="p-3">1</td>
                    <td class="p-3 font-bold">${item.salePrice}</td>
                    <td class="p-3 text-red-500 cursor-pointer" onclick="removeFromCart(${index})">âœ–</td>
                </tr>
            ).join('');
            updateTotals();
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            renderCart();
        }

        function updateTotals() {
            let subTotal = cart.reduce((sum, item) => sum + item.salePrice, 0);
            let discountValue = parseFloat(document.getElementById('discount').value) || 0;
            document.getElementById('sub-total').innerText = subTotal.toFixed(2);
            document.getElementById('final-total').innerText = (subTotal - discountValue).toFixed(2);
        }

        function confirmSale() {
            if (cart.length === 0) return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!");
            alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!");
            cart = [];
            renderCart();
            document.getElementById('discount').value = 0;
        }
    </script>
</body>
</html>
