<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8"><title>ููุทุฉ ุงูุจูุน</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50 font-['Cairo'] flex min-h-screen">
    <aside class="w-64 bg-slate-800 text-white p-5 flex flex-col gap-4">
        <h2 class="font-bold border-b border-slate-700 pb-3">ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ</h2>
        <a href="pos.html" class="p-3 bg-blue-600 rounded-lg">๐ ุงูุจูุน</a>
        <a href="inventory.html" class="p-3 hover:bg-slate-700 rounded-lg">๐ฆ ุงููุฎุฒู</a>
        <a href="funds.html" class="p-3 hover:bg-slate-700 rounded-lg">๐ฐ ุงูุตูุฏูู</a>
        <a href="returns.html" class="p-3 hover:bg-slate-700 rounded-lg">๐ ุงููุฑุชุฌุน</a>
        <a href="reports.html" class="p-3 hover:bg-slate-700 rounded-lg">๐ ุงูุชูุงุฑูุฑ</a>
        <button onclick="logout()" class="mt-auto p-3 text-red-400">๐ช ุฎุฑูุฌ</button>
    </aside>

    <main class="flex-1 p-8 grid grid-cols-3 gap-6">
        <div class="col-span-2 bg-white p-6 rounded-2xl shadow-sm">
            <div class="flex gap-4 mb-6">
                <select id="cust-type" class="p-3 border rounded-xl font-bold">
                    <option value="retail">ุฒุจูู ููุฑู</option>
                    <option value="wholesale">ุฒุจูู ุฌููุฉ</option>
                </select>
                <input id="scan" type="text" placeholder="ุงูุณุญ ุงูุจุงุฑููุฏ..." class="flex-1 p-3 border-2 border-blue-500 rounded-xl outline-none shadow-sm">
            </div>
            <table class="w-full text-right">
                <thead class="bg-gray-100"><tr class="border-b"><th class="p-3">ุงููุทุนุฉ</th><th class="p-3">ุงูุณุนุฑ</th><th class="p-3">ุฅุฌูุงูู</th></tr></thead>
                <tbody id="cart"></tbody>
            </table>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-sm flex flex-col justify-between h-fit">
            <h2 class="text-xl font-bold mb-4">ุฅุชูุงู ุงููุงุชูุฑุฉ</h2>
            <div class="space-y-4">
                <label class="text-sm text-gray-500">ุทุฑููุฉ ุงูุฏูุน (ุงูุตูุฏูู):</label>
                <select id="fund-method" class="w-full p-3 border-2 border-green-500 rounded-xl font-bold text-green-700">
                    <option value="cash">Cash</option><option value="wish">Wish Money</option><option value="plus">Cash Plus</option><option value="mobi">Mobitek</option>
                </select>
                <div class="flex justify-between font-bold"><span>ุงููุฌููุน:</span><span id="total-val">0.00</span></div>
                <div><label class="text-sm text-gray-500">ุฎุตู ูุจูุบ:</label><input id="disc" type="number" value="0" oninput="calc()" class="w-full p-2 border rounded-xl text-red-600 font-bold"></div>
                <div class="text-3xl font-black text-blue-600 pt-4 border-t text-center" id="final-val">0.00 $</div>
            </div>
            <button onclick="done()" class="w-full bg-green-600 text-white py-5 rounded-2xl font-bold text-xl mt-6">ุชู (ุญูุธ ุงูุนูููุฉ) โ</button>
        </div>
    </main>

    <script src="auth.js"></script>
    <script>
        checkAuth();
        let items = [];
        document.getElementById('scan').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const inv = JSON.parse(localStorage.getItem('inventory')) || [];
                const p = inv.find(x => x.barcode === e.target.value.trim());
                if (p) {
                    const price = document.getElementById('cust-type').value === 'wholesale' ? p.wholesale : p.retail;
                    items.push({ ...p, salePrice: price });
                    render();
                } else alert("ุงููุทุนุฉ ุบูุฑ ููุฌูุฏุฉ!");
                e.target.value = '';
            }
        });

        function render() {
            document.getElementById('cart').innerHTML = items.map(i => <tr class="border-b"><td class="p-3">${i.name}</td><td class="p-3">${i.salePrice}</td><td class="p-3 font-bold">${i.salePrice}</td></tr>).join('');
            calc();
        }
        function calc() {
            let total = items.reduce((s, i) => s + i.salePrice, 0);
            let disc = parseFloat(document.getElementById('disc').value) || 0;
            document.getElementById('total-val').innerText = total.toFixed(2);
            document.getElementById('final-val').innerText = (total - disc).toFixed(2);
        }

        function done() {
            if (!items.length) return;
            const final = parseFloat(document.getElementById('final-val').innerText);
            const method = document.getElementById('fund-method').value;

            // ุชุญุฏูุซ ุงูุตูุงุฏูู
            let f = JSON.parse(localStorage.getItem('funds')) || {cash:0, wish:0, plus:0, mobi:0};
            f[method] += final;
            localStorage.setItem('funds', JSON.stringify(f));

            // ุชุญุฏูุซ ุงููุฎุฒู
            let inv = JSON.parse(localStorage.getItem('inventory')) || [];
            items.forEach(c => { let p = inv.find(x => x.barcode === c.barcode); if(p) p.qty -= 1; });
            localStorage.setItem('inventory', JSON.stringify(inv));

            // ุชุณุฌูู ููุชูุงุฑูุฑ
            let s = JSON.parse(localStorage.getItem('sales')) || [];
            s.push({ date: new Date().toISOString(), total: final, items: items });
            localStorage.setItem('sales', JSON.stringify(s));

            alert("ุชูุช ุงูุนูููุฉ ุจูุฌุงุญ!");
            items = []; render();
        }
    </script>
</body>
</html>
